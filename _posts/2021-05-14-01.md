---
layout: post
title: Training Model by using google vegetable images
subtitle: with Yolov5, Pytorch , Macbook pro
cover-img: /assets/img/2105/02/0.png
thumbnail-img: /assets/img/2105/02/00.png
share-img: /assets/img/2105/02/0.png
tags: [yolov5, dataset, training, object_detection, pytorch, ai]
category: AI
---

# **Google Search Image Datasetìœ¼ë¡œ Pytorch, YOLOv5 ì´ìš©í•œ Detection ëª¨ë¸ í•™ìŠµ ì‹œí‚¤ê¸°**


{: .box-note}
**Note :**ìœ¤ë™ê¸€ë‹˜ì˜ [ë”¥ëŸ¬ë‹ ê²Œì‹œë¬¼](https://blog.naver.com/PostView.nhn?blogId=s_holmes25&logNo=222161274369&parentCategoryNo=&categoryNo=20&viewDate=&isShowPopularPosts=true&from=search)ë³´ê³  ì°¸ê³ 

**1) Google Search ê²°ê³¼ë¡œ ë‚˜ì˜¤ëŠ” 10ê°€ì§€ ì•¼ì±„ë“¤ì— ëŒ€í•´ ë°ì´í„° ì…‹ ëª¨ìœ¼ê¸°** 

ìœ¤ë™ê¸€ë‹˜ ë¸”ë¡œê·¸ì˜ Chrome Driver ì´ìš©í•˜ì—¬ scrapí•˜ëŠ” ì½”ë“œë¡œ ê°ê° Cabbage, Carrot, Garlic, Mushroom, Onion, Pepper, Potato, Spring_Onion, Tomato, Zucchini 10ê°€ì§€ ì•¼ì±„ì—ëŒ€í•´ì„œ ì•½ 500ê°œì”© ì´ë¯¸ì§€ë¥¼ ì €ì¥í–ˆë‹¤. 

ì•„ë˜ì™€ ê°™ì€ íŒŒì´ì¬ í˜í‚¤ì§€ ì‚¬ìš©í•´ì„œ ì½”ë“œê°€ ì§œì—¬ì ¸ìˆë‹¤. 



```python
!nvidia-smi
```


```python
import urllib.request #ì›¹ urlì„ íŒŒì´ì¬ì´ ì¸ì‹í•  ìˆ˜ ìˆê²Œí•˜ëŠ” íŒ¨í‚¤ì§€
from  bs4 import BeautifulSoup #htmlì—ì„œ ë°ì´í„° ê²€ìƒ‰ì„ ìš©ì´í•˜ê²Œ í•˜ëŠ” íŒ¨í‚¤ì§€
from selenium import webdriver  # ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìë™í™”í•˜ê¸° ìœ„í•œ í”„ë ˆì„ ì›Œí¬
from selenium.webdriver.common.keys import Keys #ì†ìœ¼ë¡œ í´ë¦­í•˜ëŠ”ê²ƒì„ ì»´í“¨í„°ê°€ ëŒ€ì‹ 
```

ì „ì²´ ì½”ë“œê°€ ì•„ë‹Œ ì£¼ìš” ë¶€ë¶„ë§Œ ë³´ë©´, ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ë¸Œë¼ìš°ì ¸ë¥¼ ì„¸íŒ…í•˜ê³ , 


```python
binary = '/Users/kanakim/chromedriver/chromedriver' #chromedriver ì„¸íŒ…
browser = webdriver.Chrome(binary) #ë¸Œë¼ìš°ì €ë¥¼ ì¸ìŠ¤í„°í™”
browser.get("https://www.google.co.kr/imghp?hl=ko&tab=ri&ogbl") #êµ¬ê¸€ ì´ë¯¸ì§€ê²€ìƒ‰ base url
elem = browser.find_element_by_xpath("//*[@class='gLFyf gsfi']") #ê²€ìƒ‰ì°½ì— í•´ë‹¹í•˜ëŠ” htmlì°¾ê³  elementaryë¡œ ì·¨í•œë‹¤. 
elem.send_keys("ì• í˜¸ë°•") #elmentaryì— ê²€ìƒ‰ì–´ ì „ë‹¬í•˜ê³ , 
elem.submit() #submit
```

í¬ë¡¬ ë¸Œë¼ìš°ì €ì—ì„œ ì´ë¯¸ì§€ ê²€ìƒ‰ê²°ê³¼ ë°”ë”” ë¶€ë¶„ì„ì—ì„œ í˜„ì¬ ë¶ˆëŸ¬ì˜¨ ì´ë¯¸ì§€ ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì˜¤ê³ , ì´ë¯¸ì§€ê°€ ìˆëŠ” urlë¥¼ ì´ìš©í•´ì„œ ì´ë¯¸ì§€ë¥¼ ê°ê° ì €ì¥í•œë‹¤. 



```python
html = browser.page_source         # í¬ë¡¬ë¸Œë¼ìš°ì ¸ì—ì„œ í˜„ì¬ ë¶ˆëŸ¬ì˜¨ ì†ŒìŠ¤ ê°€ì ¸ì˜´
soup = BeautifulSoup(html, "lxml") # html ì½”ë“œë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •

def fetch_list_url():
    params = []
    imgList = soup.find_all("img", class_="rg_i Q4LuWd")  # êµ¬ê¸€ ì´ë¯¸ì§€ url ì´ ìˆëŠ” img íƒœê·¸ì˜ _img í´ë˜ìŠ¤ì— ê°€ì„œ
    for im in imgList:
        try :
            params.append(im["src"])                   # params ë¦¬ìŠ¤íŠ¸ì— image url ì„ ë‹´ìŒ
        except KeyError:
            params.append(im["data-src"])
    return params
```

ì‹¤í–‰ì€ ì „ì²´ pythonì½”ë“œ ì•ˆì—ì„œ ê²€ìƒ‰ì–´ ë¶€ë¶„ê³¼ ì´ë¯¸ì§€ê°€ ì €ì¥ë  ë¶€ë¶„ì˜ pathë§Œ ìˆ˜ì •í•˜ê³  python program.pyë¡œ ì‹¤í–‰í•˜ë©´ëœë‹¤. ê·¸ëŸ¬ë©´ ì„¤ì €í•œ ê²½ë¡œì— ê²€ìƒ‰í•œ ì´ë¯¸ì§€ë“¤ì´ ì €ì¥ë˜ê²Œ ëœë‹¤. 

ì €ì¥ëœ ì´ë¯¸ì§€ì¤‘ì—ì„œ íŠ¸ë ˆì´ë‹ì— ì“¸ ìˆ˜ ì—†ëŠ” ì´ë¯¸ì§€ëŠ” ì‚­ì œí•˜ë©´ì„œ ì •ë¦¬í•œë‹¤. 

ë°ì´í„°ë¥¼ ëª¨ë‘ ì €ì¥í•˜ê³  ë‚œ ë‹¤ìŒì— imagesë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ì„œ ì €ì¥í•œ ì´ë¯¸ì§€ë¥¼ ëª¨ë‘ ëª¨ì€ë‹¤ ì´ë•Œ í´ë˜ìŠ¤ ë³„ë¡œ ì €ì¥ë˜ì–´ìˆìœ¼ë©´ ë‚˜ì¤‘ì— labelingí• ë•Œ í¸í•˜ë‹ˆê¹Œ ì˜®ê¸¸ë•Œë§ˆë‹¤ ë²ˆí˜¸ë¡œ ì´ë¦„ ë°”ê¿”ì„œ ì˜®ê¸°ëŠ”ê²Œ ì¢‹ë‹¤. 

![Image1](/assets/img/2105/02/1.png) 

ê·¸ ë‹¤ìŒ opencv ì´ìš©í•´ì„œ ì €ì¥í•œ ì´ë¯¸ì§€ë“¤ì„ Resizeí•´ì¤€ë‹¤. ì½”ë“œëŠ” ê·¸ëƒ¥ pathì— ìˆëŠ” .jpg í™•ì¥ìì˜ ì´ë¯¸ì§€ë“¤ë§Œ ë¶ˆëŸ¬ì™€ì„œ, ì´ë¯¸ì§€ì˜ í¬ê¸°ë¥¼ 416, 416 (í˜¹ì€ 640, 640)ìœ¼ë¡œ ì¡°ì ˆí•˜ê³ , ì¡°ì ˆí•œ ì´ë¯¸ì§€ë¥¼ ì§€ì •ëœ ê²½ë¡œì— ì €ì¥í•œë‹¤. 




```python
import  cv2
import  os
import glob
import  numpy  as np
from pathlib import Path
path =Path("/Users/kanakim/google_vegetables/zucchini/") #ì›ë³¸ ì‚¬ì§„ì´ ìˆëŠ” í´ë” ìœ„ì¹˜
path = path.glob("*.jpg")
count = 0

for k in path : 
	img = cv2.imread(str(k))
	height = np.size(img, 0)
	width = np.size(img, 1)
	resize_img = cv2.resize(img, (416 , 416), interpolation=cv2.INTER_CUBIC) #ì‚¬ì§„í¬ê¸°
	cv2.imwrite('/Users/kanakim/google_vegetables/zucchini_resize/' + str(count) + ".jpg", resize_img)  #ë¦¬ì‚¬ì´ì¦ˆëœ í›„ ì‚¬ì§„ì´ ì €ì¥ë  í´ë” ìœ„ì¹˜
	count += 1
```



**2) Labeling using labelImg**

tzutalinì˜ [labeImg](https://github.com/tzutalin/labelImg) í”„ë¡œê·¸ë¨ ì´ìš©í•˜ì—¬ì„œ custom datasetì— ëŒ€í•´ ë¼ë²¨ë§. 

ë¨¼ì € imagesí´ë” ìœ„ì¹˜í•œ ìë¦¬ì— ê°™ì´ labelsë¼ëŠ” í´ë”ë„ ìƒì„±í•´ì¤€ë‹¤. ê·¸ë¦¬ê³  ì´ ì•ˆì—ë‹¤ê°€ classes.txtë¼ëŠ” í…ìŠ¤íŠ¸íŒŒì¼ì„ ìƒì„±í•´ì„œ labelingí•  í´ë˜ìŠ¤ë“¤ì„ ì­‰ ì ëŠ”ë‹¤. 

macOSì— ëŒ€í•´ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•ë„ ê¹ƒì— ë‚˜ì™€ìˆë‹¤. 



```python
git clone https://github.com/tzutalin/labelImg.git
pip3 install pyqt5 lxml # Install qt and lxml by pip
cd labelImg
make qt5py3
python3 labelImg.py
```

ì„¤ì¹˜ë¥¼ í•˜ê³ ë‚˜ì„œ python3 labelImg.pyë¡œ ì‹¤í–‰ì‹œí‚¤ë©´ Qtì°½ì´ ëœ¨ê²Œ ëœë‹¤. ì—¬ê¸°ì„œ imageê°€ ì €ì¥ëœ í´ë” ë¶ˆëŸ¬ì˜¤ê³ , labelì €ì¥í•  í´ë” ì„¤ì •í•˜ê³  draw rect toolì´ìš©í•´ì„œ labelingì„ í•˜ë©´ëœë‹¤. 
ì´ë•Œ í”„ë¡œê·¸ë¨ì´ ê°‘ìê¸° ì¢…ë£Œë˜ê±°ë‚˜ ê»ë‹¤ í‚¤ê²Œ ë˜ë©´ í´ë˜ìŠ¤ë“¤ì´ ì´ˆê¸°í™”ë˜ë©´ì„œ ì¸ë±ì‹± ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ë° ì´ê±°ë¥¼ 1800ê°œ ì´ë¯¸ì§€ ë‹¤ ë¼ë²¨ë§ í•˜ê³  ë‚˜ì„œ ì•Œì•„ë²„ë ¸ë‹¤ ã…œ ê·¸ë˜ì„œ ì½”ë“œ ìƒˆë¡œ ì§œì„œ í´ë˜ìŠ¤ ë‹¤ë°”ê¿”ì£¼ëŠë¼ í•˜ë£¨ ë‹¤ ë‚ ë ¤ë¨¹ì—ˆë‹¤.

ê·¸ë˜ì„œ ì•Œì•„ë‚¸ê²Œ ì¼ë‹¨ labelImg/data ì•ˆì—ì„œ predefubed_classes.txtë¼ëŠ” íŒŒì¼ì´ ìˆëŠ”ë° ì´ ì•ˆì˜ í´ë˜ìŠ¤ë“¤ì„ ì‚¬ìš©í•  í´ë˜ìŠ¤ë“¤ë¡œ ë°”ê¿”ì£¼ê³  í•˜ëŠ” ê²ƒì´ ì •ì‹ ê±´ê°•ì— ì¢‹ë‹¤. 

![Image2](/assets/img/2105/02/2.png) 

ì´ê±¸ ì•ˆë°”ê¾¸ê²Œ ë˜ë©´, ë¼ë²¨ë§ í™•ì¸í• ë ¤ê³  ì „ì— ì´ë¯¸ì§€ í´ë¦­í–ˆëŠ”ë° out of index ëœ¨ë©´ì„œ í”„ë¡œê·¸ë¨ ê°•ì¢…ë˜ê³ , ë¼ë²¨ë§ëœ í…ìŠ¤íŠ¸ íŒŒì¼ í™•ì¸í•˜ë©´ ì—‰ë§ì§„ì°½ì´ ëœê²ƒì„ ë³¼ ìˆ˜ìˆë‹¤.
ê·¸ë¦¬ê³  ì¸ë±ìŠ¤ê°€ ê¼¬ì—¬ìˆì–´ì„œ í´ë˜ìŠ¤ ìˆ˜ë³´ë‹¤ ë” ë†’ì€ ë²ˆí˜¸ê°€ ë§¤ê²¨ì ¸ìˆë‹¤ë©´ ê³„ì† train.py ë”± í•˜ëŠ” ë§ˆì§€ë§‰ ë¶€ë¶„ì—ì„œ ê³„ì† ì—ëŸ¬ê°€ ë‚˜ì„œ í™”ê°€ì”ëœ© ë‚ ìˆ˜ê°€ìˆë‹¤.

ê·¸ë˜ì„œ í´ë˜ìŠ¤ ì´ë¦„ ë°”ê¿”ì£¼ëŠ” ì½”ë“œ ì§œì„œ ì‹¸ì•… ê°ˆì•„ì—ì—ˆë‹¤ ã… ã…  
ì¼ë‹¨ ì•„ë˜ ì½”ë“œë¡œ í´ë˜ìŠ¤ ìˆ˜ë³´ë‹¤ ë§ì€ í´ë˜ìŠ¤ ê°€ì§€ê³  ìˆëŠ” íŒŒì¼ë“¤ì„ ì°¾ì•„ë‚¸ë‹¤. ( í™•ì¸ìš© ) 


```python
import glob
import os
from pathlib import Path

fpath = Path("/Users/kanakim/google_vegetables/export/labels/")
fpath = fpath.glob("*.txt")

for k in fpath : 
	fr = open(str(k), 'r')
	lines = fr.readlines()
	for line in lines : 
		x = line.split()[0]
		ix = int(x)
		if ix > 10 : 
			print(k, x)	
	fr.close()
```

ê·¸ ë‹¤ìŒì— í•´ë‹¹ ì´ë¯¸ì§€ì— ë³´ë©´ì„œ ì–´ë–¤ ê°’ìœ¼ë¡œ ë°”ê¿”ì•¼í•˜ëŠ”ì§€ ì•Œì•„ë‚¸ ë‹¤ìŒì— ì½”ë“œì— ë„£ì–´ì¤€ë‹¤..... 
ì´ê²Œ ì½”ë“œë„ ë˜ ë°”ë³´ê°™ì´ ì§°ë”ë‹ˆ ì´í‹€ë™ì•ˆ ë¼ë²¨ë§í•œê²Œ ë‹¤ ë‚ ë¼ê°€ë¶€ë ¸ë‹¤. í—¤í—¤í—¿ã…ã…í—¿ ê·¼ë° ë‹¤í–‰íˆ êµ¬ê¸€ë“œë¼ì´ë¸Œì— ë‚¨ì•„ìˆì–´ì„œ ì£¼ì–´ê°€ì§€ê³  ì¼ë‹¤. 


```python
for k in fpath : 
	fr = open(str(k), 'r')
	lines = fr.readlines()
	for line in lines : 
		if x == '16' :
			fw = open(str(k), 'w')
			fw.write(line.replace(x,'4'))
			fw.close()
		elif x == '19' :
			fw = open(str(k), 'w')
			fw.write(line.replace(x,'7'))
			fw.close()
	fr.close()
```

ë¼ë²¨ë§ì´ ëë‚¬ìœ¼ë©´ ì´ì œ Colabìœ¼ë¡œ ë„˜ì–´ê°€ì„œ Trainingì„ ì‹œí‚¤ë©´ ëœë‹¤. 

ê·¸ ì „ì— data.yaml ( google_vegetable.yaml ) íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ yolov5 ì–‘ì‹ì— ë§ê²Œ ìƒì„±í•´ì¤€ë‹¤. 



```python
train: ../train/images
val: ../valid/images

nc : 11
names: ['-', 'cabbage', 'carrot', 'garlic', 'mushroom', 'onion', 'pepper', 'potato', 'spring_onion', 'tomato', 'zucchini']
```



ê·¸ í›„, êµ¬ê¸€ë“œë¼ì´ë¸Œì— imagesë‘ labels í´ë”, data.yamlíŒŒì¼ì´ ìˆëŠ” í´ë”ë¥¼ ì—…ë¡œë“œí•˜ê³ ,  

ë‚´ êµ¬ê¸€ë“œë¼ì´ë¸Œë¥¼ ë§ˆìš´íŠ¸í•´ì„œ ì—…ë¡œë“œí•œ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œí•œë‹¤.

![Image3](/assets/img/2105/02/3.png) 


**3) Yolov5 ì„¸íŒ…**

ì €ë²ˆ íŠ¸ë ˆì´ë‹ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ yolov5ë¥¼ cloneí•˜ê³  requirements.txtë¥¼ installí•œë‹¤. 



```python
%cd /content
!git clone https://github.com/ultralytics/yolov5.git
%cd /content/yolov5/
!pip install -r requirements.txt
```

    /content
    Cloning into 'yolov5'...
    remote: Enumerating objects: 6290, done.[K
    remote: Counting objects: 100% (85/85), done.[K
    remote: Compressing objects: 100% (61/61), done.[K
    remote: Total 6290 (delta 40), reused 59 (delta 24), pack-reused 6205[K
    Receiving objects: 100% (6290/6290), 8.54 MiB | 39.03 MiB/s, done.
    Resolving deltas: 100% (4294/4294), done.
    /content/yolov5
    Installing collected packages: PyYAML, thop
      Found existing installation: PyYAML 3.13
        Uninstalling PyYAML-3.13:
          Successfully uninstalled PyYAML-3.13
    Successfully installed PyYAML-5.4.1 thop-0.0.31.post2005241907




**4) ë°ì´í„° ë‚˜ëˆ„ê¸°**

ë“œë¼ì´ë¸Œì— ë§ˆìš´íŠ¸í•œ ì´ë¯¸ì§€ë“¤ì„ Training, Validation setìœ¼ë¡œ ê°€ê° ë‚˜ëˆˆë‹¤. ì´ë•Œ ë¹„ìœ¨ì„ 8:2ë¡œ ì„¤ì •í•˜ì˜€ë‹¤. 
imageë“¤ì´ ì–´ë–»ê²Œ ë‚˜ë‰˜ì—ˆëŠ”ì§€ ì €ì¥í•˜ê¸° ìœ„í•´ train, val ê°ê°ì˜ txtíŒŒì¼ì— ì´ë¯¸ì§€ë“¤ì˜ fileëª…ì„ ì €ì¥í•´ì¤€ë‹¤. 



```python
%cd /
from glob import glob
img_list = glob('/content/drive/MyDrive/google_vegetables/export/images/*.jpg')
print(len(img_list))
from sklearn.model_selection import train_test_split
train_img_list, val_img_list = train_test_split(img_list, test_size=0.2, random_state=1215)
print(len(train_img_list), len(val_img_list))
with open('/content/drive/MyDrive/google_vegetables/train.txt', 'w') as f :
  f.write('\n'.join(train_img_list)+'\n')
with open('/content/drive/MyDrive/google_vegetables/val.txt', 'w') as f :
  f.write('\n'.join(val_img_list)+'\n')


```

    /
    1702
    1361 341


yolov5 trainingì— ì‚¬ìš©ë  yamlíŒŒì¼ì— ê°ê° train, val text íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì €ì¥í•´ì¤€ë‹¤. 


```python
import yaml
with open('/content/drive/MyDrive/google_vegetables/google_vegetables.yaml', 'r') as f:
  data = yaml.load(f)

print(data)

data['train'] = '/content/drive/MyDrive/google_vegetables/train.txt'
data['val'] = '/content/drive/MyDrive/google_vegetables/val.txt'

with open('/content/drive/MyDrive/google_vegetables/google_vegetables.yaml', 'w') as f:
  yaml.dump(data, f)

print(data)

```

    {'names': ['dum', 'cabbage', 'carrot', 'garlic', 'mushroom', 'onion', 'pepper', 'potato', 'spring_onion', 'tomato', 'zucchini'], 'nc': 11, 'train': '/content/drive/MyDrive/google_vegetables/train.txt', 'val': '/content/drive/MyDrive/google_vegetables/val.txt'}
    {'names': ['dum', 'cabbage', 'carrot', 'garlic', 'mushroom', 'onion', 'pepper', 'potato', 'spring_onion', 'tomato', 'zucchini'], 'nc': 11, 'train': '/content/drive/MyDrive/google_vegetables/train.txt', 'val': '/content/drive/MyDrive/google_vegetables/val.txt'}


    /usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:3: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.
      This is separate from the ipykernel package so we can avoid doing imports until




**5) Training**

ëª¨ë“  ë°ì´í„°ê°€ ì¤€ë¹„ë˜ê³ , í•™ìŠµê³¼ì •ì„ ì¤‘ê°„ì— í™•ì¸í•  ìˆ˜ ìˆê²Œ wandbë¥¼ ì„¸íŒ…í•´ì¤€ë‹¤.  


```python
%pip install -q wandb
import wandb
wandb.login()
```

    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1.8MB 9.9MB/s 
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 133kB 52.5MB/s 
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 102kB 11.4MB/s 
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 174kB 54.8MB/s 
    [K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 71kB 10.8MB/s 
    [?25h  Building wheel for pathtools (setup.py) ... [?25l[?25hdone
      Building wheel for subprocess32 (setup.py) ... [?25l[?25hdone



    <IPython.core.display.Javascript object>


    [34m[1mwandb[0m: Appending key for api.wandb.ai to your netrc file: /root/.netrc





    True



yolov5ì˜ train.py ì½”ë“œë¥¼ ì´ìš©í•´ì„œ ëª¨ë¸ì„ í•™ìŠµì‹œí‚¨ë‹¤. 
ì´ë•Œ yamlíŒŒì¼ì„ ì•Œë ¤ì£¼ê³ , pre trained ëª¨ë¸ì˜ ì„ íƒì€ m sizeì¸ yolov5m.ptë¡œ í•œë‹¤. ì•„ë¬´ë˜ë„ ë°ì´í„°ì˜ ì§ˆì´ ì¢‹ì§€ ì•Šì€ ê²ƒ ê°™ì•„ì„œ ì¸ì‹ë¥ ì„ ë†’ì´ê¸° ìœ„í•´ì„œ ì €ë²ˆë³´ë‹¤ ì¢€ë” í° ì‚¬ì´ì¦ˆë¥¼ ì„ íƒí–ˆëŠ”ë° ë§ëŠ” ì„ íƒì¼ì§€ ëª¨ë¥´ê² ë‹¤. ã…ã… 

ì§€ê¸ˆì€ í•™ìŠµì¤‘ !!! 
epoch 64ì—ì„œ GPU ë‹¤ ì¨ê°€ì§€ê³  ë©ˆì¶°ë²„ë ¸ë‹¤
ë¹¡ì³ì„œ ë°”ë¡œ pro ê²°ì œí•´ë²„ë¦¬ê·€~ 



```python
%cd /content/yolov5
!python train.py --img 416 --batch 16 --epochs 200 --data /content/drive/MyDrive/google_vegetables/google_vegetables.yaml --weights yolov5m.pt --name vegetables_yolov5 --nosave --cache 
```

    /content/yolov5
    [34m[1mgithub: [0mup to date with https://github.com/ultralytics/yolov5 âœ…
    YOLOv5 ğŸš€ v5.0-90-g06372b1 torch 1.8.1+cu101 CUDA:0 (Tesla P100-PCIE-16GB, 16280.875MB)
    
    Namespace(adam=False, artifact_alias='latest', batch_size=16, bbox_interval=-1, bucket='', cache_images=True, cfg='', data='/content/drive/MyDrive/google_vegetables/google_vegetables.yaml', device='', entity=None, epochs=200, evolve=False, exist_ok=False, global_rank=-1, hyp='data/hyp.scratch.yaml', image_weights=False, img_size=[416, 416], label_smoothing=0.0, linear_lr=False, local_rank=-1, multi_scale=False, name='vegetables_yolov5', noautoanchor=False, nosave=True, notest=False, project='runs/train', quad=False, rect=False, resume=False, save_dir='runs/train/vegetables_yolov5', save_period=-1, single_cls=False, sync_bn=False, total_batch_size=16, upload_dataset=False, weights='yolov5m.pt', workers=8, world_size=1)
    [34m[1mtensorboard: [0mStart with 'tensorboard --logdir runs/train', view at http://localhost:6006/
    2021-05-14 05:49:31.264226: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
    [34m[1mhyperparameters: [0mlr0=0.01, lrf=0.2, momentum=0.937, weight_decay=0.0005, warmup_epochs=3.0, warmup_momentum=0.8, warmup_bias_lr=0.1, box=0.05, cls=0.5, cls_pw=1.0, obj=1.0, obj_pw=1.0, iou_t=0.2, anchor_t=4.0, fl_gamma=0.0, hsv_h=0.015, hsv_s=0.7, hsv_v=0.4, degrees=0.0, translate=0.1, scale=0.5, shear=0.0, perspective=0.0, flipud=0.0, fliplr=0.5, mosaic=1.0, mixup=0.0
    [34m[1mwandb[0m: Currently logged in as: [33mkka-na[0m (use `wandb login --relogin` to force relogin)
    2021-05-14 05:49:33.340179: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
    [34m[1mwandb[0m: Tracking run with wandb version 0.10.30
    [34m[1mwandb[0m: Syncing run [33mvegetables_yolov5[0m
    [34m[1mwandb[0m: â­ï¸ View project at [34m[4mhttps://wandb.ai/kka-na/YOLOv5[0m
    [34m[1mwandb[0m: ğŸš€ View run at [34m[4mhttps://wandb.ai/kka-na/YOLOv5/runs/2xcrm71i[0m
    [34m[1mwandb[0m: Run data is saved locally in /content/yolov5/wandb/run-20210514_054932-2xcrm71i
    [34m[1mwandb[0m: Run `wandb offline` to turn off syncing.
    
    Downloading https://github.com/ultralytics/yolov5/releases/download/v5.0/yolov5m.pt to yolov5m.pt...
    100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 41.1M/41.1M [00:01<00:00, 41.2MB/s]
    
    Overriding model.yaml nc=80 with nc=11
    
                     from  n    params  module                                  arguments                     
      0                -1  1      5280  models.common.Focus                     [3, 48, 3]                    
      1                -1  1     41664  models.common.Conv                      [48, 96, 3, 2]                
      2                -1  1     65280  models.common.C3                        [96, 96, 2]                   
      3                -1  1    166272  models.common.Conv                      [96, 192, 3, 2]               
      4                -1  1    629760  models.common.C3                        [192, 192, 6]                 
      5                -1  1    664320  models.common.Conv                      [192, 384, 3, 2]              
      6                -1  1   2512896  models.common.C3                        [384, 384, 6]                 
      7                -1  1   2655744  models.common.Conv                      [384, 768, 3, 2]              
      8                -1  1   1476864  models.common.SPP                       [768, 768, [5, 9, 13]]        
      9                -1  1   4134912  models.common.C3                        [768, 768, 2, False]          
     10                -1  1    295680  models.common.Conv                      [768, 384, 1, 1]              
     11                -1  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']          
     12           [-1, 6]  1         0  models.common.Concat                    [1]                           
     13                -1  1   1182720  models.common.C3                        [768, 384, 2, False]          
     14                -1  1     74112  models.common.Conv                      [384, 192, 1, 1]              
     15                -1  1         0  torch.nn.modules.upsampling.Upsample    [None, 2, 'nearest']          
     16           [-1, 4]  1         0  models.common.Concat                    [1]                           
     17                -1  1    296448  models.common.C3                        [384, 192, 2, False]          
     18                -1  1    332160  models.common.Conv                      [192, 192, 3, 2]              
     19          [-1, 14]  1         0  models.common.Concat                    [1]                           
     20                -1  1   1035264  models.common.C3                        [384, 384, 2, False]          
     21                -1  1   1327872  models.common.Conv                      [384, 384, 3, 2]              
     22          [-1, 10]  1         0  models.common.Concat                    [1]                           
     23                -1  1   4134912  models.common.C3                        [768, 768, 2, False]          
     24      [17, 20, 23]  1     64656  models.yolo.Detect                      [11, [[10, 13, 16, 30, 33, 23], [30, 61, 62, 45, 59, 119], [116, 90, 156, 198, 373, 326]], [192, 384, 768]]
    Model Summary: 391 layers, 21096816 parameters, 21096816 gradients, 50.5 GFLOPS
    
    Transferred 500/506 items from yolov5m.pt
    Scaled weight_decay = 0.0005
    Optimizer groups: 86 .bias, 86 conv.weight, 83 other
    [34m[1mtrain: [0mScanning '/content/drive/MyDrive/google_vegetables/train.cache' images an[0m
    [34m[1mtrain: [0mCaching images (0.7GB): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1361/1361 [00:48<00:00, 28.05it/s][0m
    [34m[1mval: [0mScanning '/content/drive/MyDrive/google_vegetables/val.cache' images and la[0m
    [34m[1mval: [0mCaching images (0.2GB): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 341/341 [00:12<00:00, 27.50it/s][0m
    Plotting labels... 
    
    [34m[1mautoanchor: [0mAnalyzing anchors... anchors/target = 4.78, Best Possible Recall (BPR) = 0.9996
    Image sizes 416 train, 416 test
    Using 4 dataloader workers
    Logging results to runs/train/vegetables_yolov5
    Starting training for 200 epochs...
    
         Epoch   gpu_mem       box       obj       cls     total    labels  img_size
         0/199     3.04G   0.09726   0.04756    0.0655    0.2103        78       416


```python
from IPython.display import Image
import os

val_img_path = val_img_list[3]
!python detect.py --weights /content/yolov5/runs/train/vegetables_yolov5/weights/best.pt --img 416 --conf 0.5 --source "{val_img_path}"
```

    Namespace(agnostic_nms=False, augment=False, classes=None, conf_thres=0.5, device='', exist_ok=False, hide_conf=False, hide_labels=False, img_size=416, iou_thres=0.45, line_thickness=3, name='exp', nosave=False, project='runs/detect', save_conf=False, save_crop=False, save_txt=False, source='/content/drive/MyDrive/google_vegetables/export/images/vegetable1498.jpg', update=False, view_img=False, weights=['/content/yolov5/runs/train/vegetables_yolov5/weights/best.pt'])
    YOLOv5 ğŸš€ v5.0-90-g06372b1 torch 1.8.1+cu101 CUDA:0 (Tesla T4, 15109.75MB)
    
    Fusing layers... 
    Model Summary: 308 layers, 21078048 parameters, 0 gradients, 50.4 GFLOPS
    image 1/1 /content/drive/MyDrive/google_vegetables/export/images/vegetable1498.jpg: 416x416 Done. (0.014s)
    Results saved to runs/detect/exp
    Done. (0.034s)

